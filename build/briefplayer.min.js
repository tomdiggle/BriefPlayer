/**
 * Brief Player v0.1.0
 *
 * Copyright (c) 2014, Tom Diggle
 * Code provided under the MIT license
 * https://github.com/tomdiggle/BriefPlayer/blob/master/license
 *
 * Requires SoundManager 2 Javascript API.
 * http://schillmania.com/projects/soundmanager2
 */

!function(a){"use strict";function b(){function b(a){return null===a||null===a.clientWidth?0:a.clientWidth}var c,d=this,e=0,f=!1;this.currentTrack=null,this.config={autoPlay:!1,autoLoad:!1},this.css={container:"bp_container","interface":"bp_interface",controls:"bp_controls",noSolution:"bp_no_solution",play:"bp_play",pause:"bp_pause",position:"bp_position",duration:"bp_duration",progressBar:"bp_progress_bar",loadedBar:"bp_loaded_bar",playedBar:"bp_played_bar"},this.cssSelector={},this.events={ontimeout:function(){d.noSolution=!0,d.updateInterface()},onload:function(a){a===!1&&(d.noSolution=!0,d.updateInterface(),d.destruct())},play:function(){d.updateButtons(!0)},stop:function(){d.updateButtons(!1)},pause:function(){d.updateButtons(!1)},resume:function(){d.updateButtons(!0)},finish:function(){setTimeout(function(){d.updateButtons(!1),d.updateInterface()},1e3)},whileloading:function(){d.updateInterface()},whileplaying:function(){d.updateInterface()}},this.createSound=function(a){null!==a&&(this.currentTrack&&this.destruct(),this.currentTrack=soundManager.createSound({id:"BriefPlayer-"+e++,url:a,autoPlay:this.config.autoPlay,onload:this.events.onload,onplay:this.events.play,onstop:this.events.stop,onpause:this.events.pause,onresume:this.events.resume,onfinish:this.events.finish,whileloading:this.events.whileloading,whileplaying:this.events.whileplaying}),this.config.autoLoad&&this.currentTrack.load())},this.play=function(){this.currentTrack.play()},this.pause=function(){this.currentTrack.pause()},this.resume=function(){this.currentTrack.resume()},this.destruct=function(){this.currentTrack.destruct(),this.currentTrack=null},this.updateInterface=function(){if(this.noSolution)return this.cssSelector.interface.style.display="none",void(this.cssSelector.noSolution.style.display="block");if(this.setProgresssBarWidth(),this.cssSelector.position&&(this.cssSelector.position.innerHTML=this.convertMiliseconds(this.position())),this.cssSelector.duration&&this.duration()>0&&(this.cssSelector.duration.innerHTML=this.convertMiliseconds(this.duration())),this.cssSelector.loadedBar&&(this.cssSelector.loadedBar.style.width=this.loaded()+"%"),this.cssSelector.playedBar){var a=this.position()/this.duration()*100|0;isNaN(a)&&(a=0),this.cssSelector.playedBar.style.width=a+"%"}},this.updateButtons=function(a){void 0===a&&(a=this.currentTrack.paused),this.cssSelector.play&&this.cssSelector.pause&&(a?(this.cssSelector.play.style.display="none",this.cssSelector.pause.style.display="block"):(this.cssSelector.play.style.display="block",this.cssSelector.pause.style.display="none"))},this.setProgresssBarWidth=function(){if(null!==this.cssSelector.progressBar){var a=b(d.cssSelector.container)-(b(this.cssSelector.controls)+b(this.cssSelector.position)+2*b(this.cssSelector.duration));this.cssSelector.progressBar.style.width=a+"px"}},this.seek=function(a){if(null!==this.currentTrack){var b=a.layerX/this.cssSelector.progressBar.clientWidth*this.duration()|0;0===this.currentTrack.playState&&this.play(),this.currentTrack.setPosition(b)}},this.loaded=function(){if(this.currentTrack){if(1===this.currentTrack.readyState){var a=this.currentTrack.bytesLoaded/this.currentTrack.bytesTotal*100|0;return isNaN(a)&&(a=0),a}return 3===this.currentTrack.readyState?100:0}return 0},this.position=function(){return this.currentTrack?this.currentTrack.position:0},this.duration=function(){return this.currentTrack?1===this.currentTrack.readyState?this.currentTrack.durationEstimate:3===this.currentTrack.readyState?this.currentTrack.duration:0:0},this.convertMiliseconds=function(a){var b=a/1e3,c=b%60|0,d=b/60%60|0,e=b/3600%24|0;return e+":"+(10>d?"0"+d:d)+":"+(10>c?"0"+c:c)},this._cssSelector=function(a){Object.keys(a).forEach(function(b){d.cssSelector[b]=document.getElementById(a[b])}),this.cssSelector.play&&this.cssSelector.play.addEventListener("click",function(){d.play()},!1),this.cssSelector.pause&&this.cssSelector.pause.addEventListener("click",function(){d.pause()},!1),this.cssSelector.progressBar&&this.cssSelector.progressBar.addEventListener("click",function(a){d.seek(a)},!1)},c=function(){return f?!1:(f=!0,d._cssSelector(d.css),d.updateInterface(),d.updateButtons(!1),a.addEventListener("resize",function(){d.setProgresssBarWidth()},!1),void document.removeEventListener("DOMContentLoaded",c,!1))},document.addEventListener("DOMContentLoaded",c,!1)}var c=null;void 0===a.briefPlayer&&(c=new b),a.briefPlayer=c}(window);